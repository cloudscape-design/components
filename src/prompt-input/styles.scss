/*
 Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 SPDX-License-Identifier: Apache-2.0
*/
/* stylelint-disable */

@use '../internal/styles' as styles;
@use '../internal/styles/tokens' as awsui;
@use '../internal/styles/foundation/' as foundation;
@use '../internal/styles/forms/constants' as constants;
@use '../internal/generated/custom-css-properties/index.scss' as custom-props;
@use '@cloudscape-design/component-toolkit/internal/focus-visible' as focus-visible;

$send-icon-right-spacing: awsui.$space-static-xxs;
$invalid-border-offset: constants.$invalid-control-left-padding;

.root {
  @include styles.styles-reset;
  @include styles.control-border-radius-full();
  cursor: text;

  background-color: var(#{custom-props.$promptInputStyleBackgroundDefault}, awsui.$color-background-input-default);

  border-block: awsui.$border-width-field solid
    var(#{custom-props.$promptInputStyleBorderColorDefault}, awsui.$color-border-input-default);
  border-inline: awsui.$border-width-field solid
    var(#{custom-props.$promptInputStyleBorderColorDefault}, awsui.$color-border-input-default);

  box-shadow: var(#{custom-props.$promptInputStyleBoxShadowDefault});

  &:hover {
    background-color: var(
      #{custom-props.$promptInputStyleBackgroundHover},
      var(#{custom-props.$promptInputStyleBackgroundDefault}, awsui.$color-background-input-default)
    );
    border-color: var(
      #{custom-props.$promptInputStyleBorderColorHover},
      var(#{custom-props.$promptInputStyleBorderColorDefault}, awsui.$color-border-input-default)
    );
    box-shadow: var(
      #{custom-props.$promptInputStyleBoxShadowHover},
      var(#{custom-props.$promptInputStyleBoxShadowDefault})
    );
  }

  &.textarea-readonly {
    @include styles.form-readonly-element(
      $background-color: var(
          #{custom-props.$promptInputStyleBackgroundReadonly},
          var(#{custom-props.$promptInputStyleBackgroundDefault}, awsui.$color-background-input-default)
        ),
      $border-color: var(
          #{custom-props.$promptInputStyleBorderColorReadonly},
          var(#{custom-props.$promptInputStyleBorderColorDefault}, awsui.$color-border-input-disabled)
        )
    );
    box-shadow: var(#{custom-props.$promptInputStyleBoxShadowReadonly});
  }

  &.disabled {
    @include styles.form-disabled-element(
      $background-color: var(
          #{custom-props.$promptInputStyleBackgroundDisabled},
          awsui.$color-background-input-disabled
        ),
      $border-color: var(#{custom-props.$promptInputStyleBorderColorDisabled}, awsui.$color-border-input-disabled),
      $color: var(#{custom-props.$promptInputStyleColorDisabled}, awsui.$color-text-input-disabled),
      $cursor: default
    );
    box-shadow: var(#{custom-props.$promptInputStyleBoxShadowDisabled});
  }

  &.textarea-invalid {
    @include styles.form-invalid-control(
      $color: var(#{custom-props.$promptInputStyleColorDefault}, awsui.$color-text-status-error),
      $border-color: var(#{custom-props.$promptInputStyleBorderColorDefault}, awsui.$color-text-status-error)
    );
    & {
      padding-inline-start: 0;
    }

    &:focus-within,
    &:focus {
      @include styles.form-invalid-control(
        $color: var(#{custom-props.$promptInputStyleColorDefault}, awsui.$color-text-status-error),
        $border-color: var(#{custom-props.$promptInputStyleBorderColorDefault}, awsui.$color-text-status-error)
      );
      & {
        padding-inline-start: 0;
        box-shadow: foundation.$box-shadow-focused-light-invalid;
      }
    }
  }

  &.textarea-warning {
    @include styles.form-warning-control(
      $color: var(#{custom-props.$promptInputStyleColorDefault}, awsui.$color-text-status-warning),
      $border-color: var(#{custom-props.$promptInputStyleBorderColorDefault}, awsui.$color-text-status-warning)
    );
    & {
      padding-inline-start: 0;
    }

    &:focus-within,
    &:focus {
      @include styles.form-warning-control(
        $color: var(#{custom-props.$promptInputStyleColorDefault}, awsui.$color-text-status-warning),
        $border-color: var(#{custom-props.$promptInputStyleBorderColorDefault}, awsui.$color-text-status-warning)
      );
      & {
        padding-inline-start: 0;
        box-shadow: foundation.$box-shadow-focused-light-invalid;
      }
    }
  }

  &:focus-within,
  &:focus {
    @include styles.form-focus-element(
      $border-color: var(#{custom-props.$promptInputStyleBorderColorFocus}, awsui.$color-border-input-focused),
      $box-shadow: var(#{custom-props.$promptInputStyleBoxShadowFocus}, foundation.$box-shadow-focused-light)
    );
    background-color: var(#{custom-props.$promptInputStyleBackgroundFocus}, awsui.$color-background-input-default);
  }

  // Prevent focus styles when disabled
  &.disabled:focus-within,
  &.disabled:focus {
    @include styles.form-disabled-element(
      $background-color: var(
          #{custom-props.$promptInputStyleBackgroundDisabled},
          awsui.$color-background-input-disabled
        ),
      $border-color: var(#{custom-props.$promptInputStyleBorderColorDisabled}, awsui.$color-border-input-disabled),
      $color: var(#{custom-props.$promptInputStyleColorDisabled}, awsui.$color-text-input-disabled),
      $cursor: default
    );
    box-shadow: var(#{custom-props.$promptInputStyleBoxShadowDisabled});
  }
}

.textarea {
  @include styles.styles-reset;
  @include styles.font-body-m;
  // Restore browsers' default resize values
  resize: none;
  // Restore default text cursor
  cursor: text;
  // Allow multi-line placeholders and word wrapping
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow-wrap: break-word;
  background-color: transparent;

  padding-block: styles.$control-padding-vertical;
  padding-inline: styles.$control-padding-horizontal;

  color: var(#{custom-props.$promptInputStyleColorDefault}, awsui.$color-text-body-default);
  inline-size: 100%;
  display: block;
  box-sizing: border-box;
  overflow-y: auto;
  overflow-x: hidden;

  border: 0;

  &.placeholder-visible::before {
    content: attr(data-placeholder);
    @include styles.form-placeholder(
      $color: var(#{custom-props.$promptInputStylePlaceholderColor}, awsui.$color-text-input-placeholder),
      $font-size: var(#{custom-props.$promptInputStylePlaceholderFontSize}),
      $font-style: var(#{custom-props.$promptInputStylePlaceholderFontStyle}, italic),
      $font-weight: var(#{custom-props.$promptInputStylePlaceholderFontWeight})
    );
    opacity: 1;
    pointer-events: none;
    position: absolute;
    inset-block-start: styles.$control-padding-vertical;
    inset-inline-start: styles.$control-padding-horizontal;
  }

  &:hover {
    color: var(
      #{custom-props.$promptInputStyleColorHover},
      var(#{custom-props.$promptInputStyleColorDefault}, awsui.$color-text-body-default)
    );
  }

  &:focus {
    outline: none;
    color: var(
      #{custom-props.$promptInputStyleColorFocus},
      var(#{custom-props.$promptInputStyleColorDefault}, awsui.$color-text-body-default)
    );
  }

  &:invalid {
    // discard built-in invalid styles, customers should use `invalid` property only (AWSUI-3947)
    box-shadow: none;
  }

  &.invalid,
  &.warning {
    padding-inline-start: $invalid-border-offset;
  }

  &:disabled,
  &.textarea-disabled {
    color: var(#{custom-props.$promptInputStyleColorDisabled}, awsui.$color-text-input-disabled);
    @include styles.form-disabled-element;
    cursor: default;
    overflow-y: hidden;

    // Prevent focus styles when disabled
    &:focus-within,
    &:focus {
      @include styles.form-disabled-element;
      box-shadow: none;
    }

    &::placeholder {
      @include styles.form-placeholder-disabled;
      opacity: 1;
    }
  }

  &-readonly {
    color: var(
      #{custom-props.$promptInputStyleColorReadonly},
      var(#{custom-props.$promptInputStyleColorDefault}, awsui.$color-text-body-default)
    );
  }
  // Placeholder for disabled contentEditable div
  &.placeholder-visible::before {
    @include styles.form-placeholder-disabled;
    opacity: 1;
    pointer-events: none; // Prevent cursor from getting stuck on placeholder in Safari
  }

  &-wrapper {
    display: flex;
    position: relative;
  }
}

.editable-wrapper {
  flex: 1;
  min-inline-size: 0;
  position: relative;
}

.primary-action {
  align-self: flex-end;
  flex-shrink: 0;
  padding-inline-start: calc(styles.$control-padding-horizontal / 2);

  .textarea-wrapper > & {
    padding-inline-end: calc(styles.$control-padding-horizontal / 2);

    > .action-button {
      margin-block-end: awsui.$space-scaled-xxxs;
      padding: 0;
    }
  }
}

.secondary-content {
  @include styles.styles-reset;
  @include styles.control-border-radius-full();

  &.with-paddings {
    padding-block-start: awsui.$space-scaled-s;
    padding-block-end: awsui.$space-scaled-s;
    padding-inline-start: styles.$control-padding-horizontal;
    padding-inline-end: styles.$control-padding-horizontal;

    &.invalid,
    &.warning {
      padding-inline-start: $invalid-border-offset;
    }
  }
}

.action-stripe {
  @include styles.styles-reset;
  @include styles.control-border-radius-full();
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
}

.secondary-actions {
  flex-basis: max-content;
  flex-grow: 0;
  flex-shrink: 1;
  box-sizing: border-box;
  // Just like styles.text-flex-wrapping without the overflow: hidden to prevent focus rings on action buttons from being clipped.
  word-wrap: break-word;
  max-inline-size: 100%;
  &.with-paddings {
    padding-inline: styles.$control-padding-horizontal;
    padding-block-start: awsui.$space-scaled-s;
    padding-block-end: styles.$control-padding-vertical;

    &.invalid,
    &.warning {
      padding-inline-start: $invalid-border-offset;
    }
  }
  &.with-paddings-and-actions {
    padding-inline-end: 0;
  }
}

.buffer {
  flex: 1;
  align-self: stretch;
  cursor: text;
}

.token-container {
  display: inline-block;
  user-select: all;
  -webkit-user-select: all;
  -moz-user-select: all;
  padding-inline: awsui.$space-xxxs;
}

// Paragraph elements - reset browser default margins/padding
.paragraph {
  @include styles.styles-reset;
  // Ensure paragraphs are only as tall as their line-height
  margin: 0;
  padding: 0;
  // Preserve whitespace including trailing spaces
  white-space: pre-wrap;
  // Inherit color from parent (textarea) for disabled/readonly states
  color: inherit;

  // Prevent focus styles on paragraphs when parent textarea is disabled
  .textarea-disabled & {
    &:focus-within,
    &:focus {
      background: inherit;
      outline: none;
    }
  }
}
